{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://agent-life.ai/schemas/v1/attachments.schema.json",
  "title": "ALF Attachments",
  "description": "Workspace artifact index. Artifacts are classified into three tiers: Tier 1 (managed agent state) goes in raw/, Tier 2 (portable artifacts under size threshold) are included in artifacts/ within the archive, Tier 3 (large artifacts) are cataloged by reference only. See ยง3.1.9 of the ALF Specification.",
  "type": "object",
  "required": ["attachments"],
  "properties": {
    "artifact_size_threshold": {
      "type": "integer",
      "description": "The size threshold in bytes used to classify Tier 2 (included) vs. Tier 3 (reference-only) artifacts. Default: 102400 (100 KB).",
      "default": 102400,
      "minimum": 0
    },
    "attachments": {
      "type": "array",
      "description": "List of workspace artifact references. Includes both Tier 2 (included in archive) and Tier 3 (reference-only) artifacts.",
      "items": {
        "$ref": "#/$defs/AttachmentReference"
      },
      "minItems": 0
    }
  },
  "additionalProperties": true,
  "$defs": {
    "AttachmentReference": {
      "title": "Attachment Reference",
      "description": "A reference to a workspace artifact. If archive_path is non-null (Tier 2), the file is included in the archive under artifacts/. If archive_path is null (Tier 3), the file is reference-only.",
      "type": "object",
      "required": [
        "id",
        "filename",
        "media_type",
        "size_bytes",
        "hash",
        "source_path",
        "archive_path",
        "remote_ref"
      ],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for this artifact reference.",
          "format": "uuid"
        },
        "filename": {
          "type": "string",
          "description": "Original filename."
        },
        "media_type": {
          "type": "string",
          "description": "MIME type (e.g., 'image/png', 'text/csv', 'text/x-python', 'application/pdf')."
        },
        "size_bytes": {
          "type": "integer",
          "description": "File size at time of export.",
          "minimum": 0
        },
        "hash": {
          "$ref": "#/$defs/ContentHash"
        },
        "source_path": {
          "type": "string",
          "description": "Path relative to the runtime workspace where the file was found."
        },
        "archive_path": {
          "type": ["string", "null"],
          "description": "Path within the ALF archive if the file is included (Tier 2, e.g., 'artifacts/shares_tracker.csv'). Null if reference-only (Tier 3)."
        },
        "remote_ref": {
          "type": ["string", "null"],
          "description": "URL for future online storage. Null in initial releases. When the sync service adds artifact storage, this is populated with a content-addressable URL.",
          "format": "uri"
        },
        "referenced_by": {
          "type": "array",
          "description": "Memory record IDs that reference this artifact.",
          "items": {
            "type": "string",
            "format": "uuid"
          }
        }
      },
      "additionalProperties": true
    },
    "ContentHash": {
      "title": "Content Hash",
      "description": "Integrity hash of the file content.",
      "type": "object",
      "required": ["algorithm", "value"],
      "properties": {
        "algorithm": {
          "type": "string",
          "description": "Hash algorithm. Default: 'sha256'.",
          "default": "sha256"
        },
        "value": {
          "type": "string",
          "description": "Hex-encoded hash value."
        }
      },
      "additionalProperties": true
    }
  }
}
