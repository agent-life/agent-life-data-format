{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://agent-life.ai/schemas/v1/credentials.schema.json",
  "title": "ALF Credentials",
  "description": "Layer 4: Accounts and credentials. Zero-knowledge architecture — all payloads are client-side encrypted. The sync service stores only ciphertext. See §3.4 of the ALF Specification.",
  "type": "object",
  "required": ["credentials"],
  "properties": {
    "credentials": {
      "type": "array",
      "description": "List of encrypted credential records.",
      "items": {
        "$ref": "#/$defs/CredentialRecord"
      },
      "minItems": 0
    }
  },
  "additionalProperties": true,
  "$defs": {
    "CredentialRecord": {
      "title": "Credential Record",
      "description": "A single encrypted credential. See §3.4.2.",
      "type": "object",
      "required": [
        "id",
        "agent_id",
        "service",
        "credential_type",
        "encrypted_payload",
        "encryption",
        "created_at"
      ],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for this credential.",
          "format": "uuid"
        },
        "agent_id": {
          "type": "string",
          "description": "The agent this credential belongs to.",
          "format": "uuid"
        },
        "service": {
          "type": "string",
          "description": "The service this credential authenticates to (e.g., 'openai', 'github', 'slack')."
        },
        "credential_type": {
          "type": "string",
          "description": "Type of credential. Known values: api_key, oauth_token, webhook_secret, session_token, ssh_key, certificate, custom. Validators SHOULD warn on unknown values but MUST NOT reject them — unknown types are treated as 'custom' per §8.2.",
          "enum": ["api_key", "oauth_token", "webhook_secret", "session_token", "ssh_key", "certificate", "custom"],
          "x-unknown-default": "custom"
        },
        "label": {
          "type": "string",
          "description": "Human-readable label (e.g., 'OpenAI Production Key')."
        },
        "capabilities_granted": {
          "type": "array",
          "description": "Capability names (from identity.structured.capabilities) that this credential enables. Informational — helps the importing adapter wire credentials to tools. The reverse linkage (capability to credential) is via credential_ids on the capability schema.",
          "items": {
            "type": "string"
          }
        },
        "encrypted_payload": {
          "type": "string",
          "description": "Base64-encoded ciphertext containing the credential material."
        },
        "encryption": {
          "$ref": "#/$defs/EncryptionMetadata"
        },
        "created_at": {
          "type": "string",
          "description": "When this credential was first stored.",
          "format": "date-time"
        },
        "updated_at": {
          "type": ["string", "null"],
          "description": "When this credential was last updated.",
          "format": "date-time"
        },
        "last_rotated_at": {
          "type": ["string", "null"],
          "description": "When the credential was last rotated.",
          "format": "date-time"
        },
        "expires_at": {
          "type": ["string", "null"],
          "description": "When this credential expires. Null if it does not expire.",
          "format": "date-time"
        },
        "tags": {
          "type": "array",
          "description": "Tags for categorization and filtering.",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": true
    },
    "EncryptionMetadata": {
      "title": "Encryption Metadata",
      "description": "Metadata about how the credential payload was encrypted. Stored in plaintext alongside the ciphertext. See §3.4.1.",
      "type": "object",
      "required": ["algorithm", "nonce"],
      "properties": {
        "algorithm": {
          "type": "string",
          "description": "Encryption algorithm identifier. Recommended: 'xchacha20-poly1305'."
        },
        "kdf": {
          "type": "string",
          "description": "Key derivation function. Recommended: 'argon2id'."
        },
        "kdf_params": {
          "type": "object",
          "description": "Parameters for the key derivation function.",
          "properties": {
            "memory_cost": {
              "type": "integer",
              "description": "Memory cost in KiB.",
              "minimum": 1
            },
            "time_cost": {
              "type": "integer",
              "description": "Number of iterations.",
              "minimum": 1
            },
            "parallelism": {
              "type": "integer",
              "description": "Degree of parallelism.",
              "minimum": 1
            }
          },
          "additionalProperties": true
        },
        "nonce": {
          "type": "string",
          "description": "Base64-encoded nonce used for encryption."
        }
      },
      "additionalProperties": true
    }
  }
}
